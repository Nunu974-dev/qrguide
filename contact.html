<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - QRGUIDE.FR</title>
    <link rel="icon" type="image/jpeg" href="img/logo_icone.jpg">
    <link rel="stylesheet" href="style.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="index.html"><img src="img/logo.png" alt="QRGUIDE.FR" class="logo"></a>
                <div class="nav-links">
                    <a href="index.html#fonctionnalites">Fonctionnalit√©s</a>
                    <a href="index.html#comment-ca-marche">Comment √ßa marche</a>
                    <a href="tarifs.html">Tarifs</a>
                    <a href="contact.html" class="btn-primary">Commencer</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Contact Hero -->
    <section class="contact-hero">
        <div class="container">
            <h1>Commencez d√®s aujourd'hui</h1>
            <p>Remplissez le formulaire et recevez votre guide personnalis√© en 48h</p>
            
            <div class="trust-badges">
                <div class="trust-item">
                    <span class="trust-icon">‚úì</span>
                    <span>R√©ponse sous 24h</span>
                </div>
                <div class="trust-item">
                    <span class="trust-icon">‚úì</span>
                    <span>Sans engagement</span>
                </div>
                <div class="trust-item">
                    <span class="trust-icon">‚úì</span>
                    <span>Installation en 48h</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Form Section -->
    <section class="contact-section">
        <div class="container">
            <div class="contact-grid">
                <!-- Form -->
                <div class="contact-form-wrapper">
                    <form class="contact-form" id="contactForm">
                        <h3>Informations personnelles</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nom">Nom complet *</label>
                                <input type="text" id="nom" name="nom" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="telephone">T√©l√©phone *</label>
                                <input type="tel" id="telephone" name="telephone" required>
                            </div>
                            <div class="form-group">
                                <label for="ville">Ville du logement *</label>
                                <input type="text" id="ville" name="ville" required>
                            </div>
                        </div>

                        <h3 style="margin-top: 32px;">Votre logement</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="type">Type de logement *</label>
                                <select id="type" name="type" required>
                                    <option value="">S√©lectionnez...</option>
                                    <option value="appartement">Appartement</option>
                                    <option value="maison">Maison</option>
                                    <option value="villa">Villa</option>
                                    <option value="chalet">Chalet</option>
                                    <option value="studio">Studio</option>
                                    <option value="autre">Autre</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="nombre">Nombre de logements *</label>
                                <select id="nombre" name="nombre" required>
                                    <option value="">S√©lectionnez...</option>
                                    <option value="1">1 logement</option>
                                    <option value="2-3">2-3 logements</option>
                                    <option value="4-5">4-5 logements</option>
                                    <option value="6+">6+ logements</option>
                                </select>
                            </div>
                        </div>

                        <h3 style="margin-top: 32px;">Votre choix</h3>

                        <div class="form-group">
                            <label>Formule souhait√©e *</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="plan" value="mensuel" id="plan-mensuel">
                                    <div class="radio-content">
                                        <strong>Abonnement Mensuel</strong>
                                        <span>8‚Ç¨/mois</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="plan" value="annuel" id="plan-annuel">
                                    <div class="radio-content">
                                        <strong>Abonnement Annuel</strong>
                                        <span>75‚Ç¨/an ‚Ä¢ √âconomisez 21‚Ç¨</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="plan" value="complet" id="plan-complet" checked>
                                    <div class="radio-content">
                                        <strong>Pack Complet</strong>
                                        <span>240‚Ç¨ ‚Ä¢ Cr√©ation + Plaque + 1 an</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Options *</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="options" value="creation" id="option-creation" checked>
                                    <span>Pack Cr√©ation (150‚Ç¨)</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="options" value="plaque" id="option-plaque">
                                    <span>Plaque QR Code (45‚Ç¨)</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="message">Message (optionnel)</label>
                            <textarea id="message" name="message" rows="4" placeholder="Questions, demandes sp√©cifiques..."></textarea>
                        </div>

                        <div class="form-total">
                            <div class="total-label">Total estim√© :</div>
                            <div class="total-amount" id="totalAmount">150‚Ç¨</div>
                        </div>

                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button type="button" id="contactOnlyBtn" class="btn-secondary" style="flex: 1; min-width: 200px;">
                                üìß Demander des infos
                            </button>
                            <button type="submit" id="paymentBtn" class="btn-hero" style="flex: 1; min-width: 200px;">
                                üí≥ Payer maintenant
                            </button>
                        </div>
                        
                        <p class="form-notice">
                            <strong>Paiement s√©curis√© par Stripe</strong><br>
                            En soumettant ce formulaire, vous acceptez d'√™tre contact√© par QRGUIDE.FR concernant votre demande.
                        </p>
                    </form>
                </div>

                <!-- Contact Info -->
                <div class="contact-info">
                    <div class="info-card">
                        <h3>Besoin d'aide ?</h3>
                        <p>Notre √©quipe est l√† pour r√©pondre √† toutes vos questions</p>
                        
                        <div class="contact-methods">
                            <a href="mailto:contact@qrguide.fr" class="contact-method">
                                <span class="method-icon">‚úâÔ∏è</span>
                                <div>
                                    <strong>Email</strong>
                                    <span>contact@qrguide.fr</span>
                                </div>
                            </a>
                            
                            <a href="tel:+33612345678" class="contact-method">
                                <span class="method-icon">üìû</span>
                                <div>
                                    <strong>T√©l√©phone</strong>
                                    <span>06 92 63 03 64</span>
                                </div>
                            </a>
                            
                            <div class="contact-method">
                                <span class="method-icon">‚è∞</span>
                                <div>
                                    <strong>Horaires</strong>
                                    <span>Lun-Ven : 9h-18h</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3>Processus</h3>
                        <div class="process-steps">
                            <div class="process-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <strong>Vous remplissez le formulaire</strong>
                                    <p>15 minutes suffisent</p>
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <strong>Nous cr√©ons votre guide</strong>
                                    <p>Livraison sous 48h</p>
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <strong>Vous validez et publiez</strong>
                                    <p>2 r√©visions offertes</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-card highlight">
                        <h3>üéÅ Offre de lancement</h3>
                        <p>Pack Complet √† 240‚Ç¨ au lieu de 270‚Ç¨</p>
                        <ul class="offer-benefits">
                            <li>‚úì Cr√©ation du guide</li>
                            <li>‚úì Plaque QR Code</li>
                            <li>‚úì 1 an d'abonnement</li>
                            <li>‚úì √âconomisez 30‚Ç¨</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ -->
    <section class="faq-section" style="background: #f8f9fa; padding: 60px 0;">
        <div class="container">
            <h2>Questions fr√©quentes</h2>
            
            <div class="faq-grid">
                <div class="faq-item">
                    <h4>Quelles informations fournir ?</h4>
                    <p>Vos coordonn√©es, adresse du logement, code Wi-Fi, √©quipements disponibles, bonnes adresses locales, r√®glement int√©rieur.</p>
                </div>
                <div class="faq-item">
                    <h4>Combien de temps pour la cr√©ation ?</h4>
                    <p>48h apr√®s r√©ception de toutes vos informations. Livraison par email avec lien vers votre guide.</p>
                </div>
                <div class="faq-item">
                    <h4>Puis-je modifier apr√®s cr√©ation ?</h4>
                    <p>Oui, vous avez acc√®s √† un panneau d'administration pour modifier tout le contenu en temps r√©el.</p>
                </div>
                <div class="faq-item">
                    <h4>Comment imprimer le QR code ?</h4>
                    <p>Nous vous fournissons un fichier PDF haute qualit√©. Vous pouvez l'imprimer ou commander notre plaque professionnelle.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <img src="img/logo.png" alt="QRGUIDE.FR" class="footer-logo">
                    <p>Le guide num√©rique nouvelle g√©n√©ration pour locations saisonni√®res</p>
                </div>
                <div class="footer-col">
                    <h4>Produit</h4>
                    <a href="index.html#fonctionnalites">Fonctionnalit√©s</a>
                    <a href="index.html#comment-ca-marche">Comment √ßa marche</a>
                    <a href="tarifs.html">Tarifs</a>
                    <a href="demo-guide/index.html" target="_blank">Voir la d√©mo</a>
                </div>
                <div class="footer-col">
                    <h4>Support</h4>
                    <a href="contact.html">Contact</a>
                    <a href="mailto:contact@qrguide.fr">contact@qrguide.fr</a>
                    <a href="tel:0692630364">06 92 63 03 64</a>
                </div>
                <div class="footer-col">
                    <h4>L√©gal</h4>
                    <a href="#">Mentions l√©gales</a>
                    <a href="#">CGV</a>
                    <a href="#">Confidentialit√©</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 QRGUIDE.FR - Tous droits r√©serv√©s</p>
            </div>
        </div>
    </footer>

    <script>
        // ============================================
        // CONFIGURATION - √Ä MODIFIER AVEC VOS CL√âS
        // ============================================
        
        // 1. Remplacez avec votre cl√© Stripe Publishable Key (pk_test_... ou pk_live_...)
        // Obtenir sur : https://dashboard.stripe.com/apikeys
        const STRIPE_KEY = 'pk_test_VOTRE_CLE_STRIPE_ICI';
        const stripe = Stripe(STRIPE_KEY);

        // 2. Remplacez avec vos Price IDs Stripe (cr√©√©s dans Products sur Stripe Dashboard)
        const STRIPE_PRICES = {
            mensuel: 'price_MENSUEL_ID',
            annuel: 'price_ANNUEL_ID',
            creation: 'price_CREATION_ID',
            plaque: 'price_PLAQUE_ID',
            complet: 'price_PACK_COMPLET_ID'
        };

        // 3. Configuration EmailJS (obtenir sur https://www.emailjs.com/)
        const EMAILJS_CONFIG = {
            publicKey: 'VOTRE_PUBLIC_KEY',
            serviceId: 'VOTRE_SERVICE_ID',
            templateId: 'VOTRE_TEMPLATE_ID'
        };

        // Initialiser EmailJS
        emailjs.init(EMAILJS_CONFIG.publicKey);

        // ============================================
        // CALCUL DU TOTAL
        // ============================================
        function calculateTotal() {
            const plan = document.querySelector('input[name="plan"]:checked');
            const creation = document.getElementById('option-creation').checked;
            const plaque = document.getElementById('option-plaque').checked;
            
            let total = 0;
            let description = [];

            // Abonnement
            if (plan) {
                if (plan.value === 'mensuel') {
                    total += 8;
                    description.push('8‚Ç¨/mois');
                } else if (plan.value === 'annuel') {
                    total += 75;
                    description.push('75‚Ç¨/an');
                } else if (plan.value === 'complet') {
                    total = 240;
                    description.push('Pack Complet : 240‚Ç¨');
                    document.getElementById('totalAmount').innerHTML = total + '‚Ç¨<br><small style="font-size: 14px; opacity: 0.7;">Paiement unique</small>';
                    return;
                }
            }

            // Cr√©ation
            if (creation) {
                total += 150;
                description.push('Cr√©ation : 150‚Ç¨');
            }

            // Plaque
            if (plaque) {
                total += 45;
                description.push('Plaque : 45‚Ç¨');
            }

            document.getElementById('totalAmount').innerHTML = total + '‚Ç¨<br><small style="font-size: 14px; opacity: 0.7;">' + description.join(' + ') + '</small>';
        }

        // ============================================
        // R√âCUP√âRATION DES DONN√âES DU FORMULAIRE
        // ============================================
        function getFormData() {
            const plan = document.querySelector('input[name="plan"]:checked');
            const creation = document.getElementById('option-creation').checked;
            const plaque = document.getElementById('option-plaque').checked;
            const total = document.getElementById('totalAmount').textContent.split('‚Ç¨')[0];

            return {
                nom: document.getElementById('nom').value,
                email: document.getElementById('email').value,
                telephone: document.getElementById('telephone').value,
                ville: document.getElementById('ville').value,
                type: document.getElementById('type').value,
                nombre: document.getElementById('nombre').value,
                plan: plan ? plan.value : '',
                planLabel: plan ? plan.parentElement.querySelector('strong').textContent : '',
                options: (creation ? 'Cr√©ation' : '') + (creation && plaque ? ' + ' : '') + (plaque ? 'Plaque' : ''),
                message: document.getElementById('message').value,
                total: total + '‚Ç¨'
            };
        }

        // ============================================
        // ENVOI EMAIL VIA EMAILJS
        // ============================================
        async function sendEmail(formData) {
            try {
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.templateId,
                    formData
                );
                console.log('Email envoy√© avec succ√®s:', response);
                return true;
            } catch (error) {
                console.error('Erreur envoi email:', error);
                return false;
            }
        }

        // ============================================
        // PAIEMENT STRIPE
        // ============================================
        async function processPayment() {
            const plan = document.querySelector('input[name="plan"]:checked');
            const creation = document.getElementById('option-creation').checked;
            const plaque = document.getElementById('option-plaque').checked;

            if (!plan) {
                alert('Veuillez s√©lectionner une formule');
                return;
            }

            // Pr√©parer les items pour Stripe Checkout
            const lineItems = [];

            // Ajouter l'abonnement ou le pack complet
            if (plan.value === 'complet') {
                lineItems.push({
                    price: STRIPE_PRICES.complet,
                    quantity: 1
                });
            } else {
                // Abonnement
                lineItems.push({
                    price: STRIPE_PRICES[plan.value],
                    quantity: 1
                });

                // Cr√©ation (obligatoire pour abonnements)
                if (creation) {
                    lineItems.push({
                        price: STRIPE_PRICES.creation,
                        quantity: 1
                    });
                }

                // Plaque optionnelle
                if (plaque) {
                    lineItems.push({
                        price: STRIPE_PRICES.plaque,
                        quantity: 1
                    });
                }
            }

            // R√©cup√©rer les infos client
            const formData = getFormData();

            try {
                // Rediriger vers Stripe Checkout
                const { error } = await stripe.redirectToCheckout({
                    lineItems: lineItems,
                    mode: plan.value === 'mensuel' ? 'subscription' : (plan.value === 'annuel' ? 'subscription' : 'payment'),
                    successUrl: window.location.origin + '/success.html',
                    cancelUrl: window.location.origin + '/contact.html',
                    customerEmail: formData.email,
                    clientReferenceId: formData.nom,
                    billingAddressCollection: 'required',
                    shippingAddressCollection: plaque ? {
                        allowedCountries: ['FR']
                    } : undefined
                });

                if (error) {
                    console.error('Erreur Stripe:', error);
                    alert('Erreur lors du paiement. Veuillez r√©essayer.');
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de la redirection vers le paiement.');
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        
        // Calcul automatique du total
        document.querySelectorAll('input[name="plan"]').forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value !== 'complet') {
                    document.getElementById('option-creation').checked = true;
                }
                calculateTotal();
            });
        });

        document.getElementById('option-creation').addEventListener('change', calculateTotal);
        document.getElementById('option-plaque').addEventListener('change', calculateTotal);

        // Bouton "Demander des infos" (email uniquement)
        document.getElementById('contactOnlyBtn').addEventListener('click', async function() {
            const form = document.getElementById('contactForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = getFormData();
            this.disabled = true;
            this.textContent = 'üìß Envoi en cours...';

            const success = await sendEmail(formData);
            
            if (success) {
                alert('‚úÖ Votre demande a √©t√© envoy√©e avec succ√®s !\n\nNous vous r√©pondons sous 24h.');
                form.reset();
                calculateTotal();
            } else {
                alert('‚ùå Erreur lors de l\'envoi. Veuillez r√©essayer ou nous contacter par t√©l√©phone.');
            }

            this.disabled = false;
            this.textContent = 'üìß Demander des infos';
        });

        // Bouton "Payer maintenant" (email + paiement)
        document.getElementById('contactForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = getFormData();
            
            // Envoyer l'email d'abord
            const paymentBtn = document.getElementById('paymentBtn');
            paymentBtn.disabled = true;
            paymentBtn.textContent = 'üìß Envoi des infos...';

            await sendEmail(formData);

            // Puis rediriger vers le paiement
            paymentBtn.textContent = 'üí≥ Redirection vers le paiement...';
            await processPayment();

            paymentBtn.disabled = false;
            paymentBtn.textContent = 'üí≥ Payer maintenant';
        });

        // Pre-select plan from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const planParam = urlParams.get('plan');
        if (planParam === 'abonnement') {
            document.getElementById('plan-mensuel').checked = true;
        } else if (planParam === 'creation') {
            document.getElementById('plan-complet').checked = false;
            document.getElementById('plan-mensuel').checked = true;
            document.getElementById('option-creation').checked = true;
        } else if (planParam === 'plaque') {
            document.getElementById('option-plaque').checked = true;
        } else if (planParam === 'complet') {
            document.getElementById('plan-complet').checked = true;
        }
        
        calculateTotal();
    </script>
</body>
</html>
